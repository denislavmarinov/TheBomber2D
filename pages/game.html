<!DOCTYPE html>
<html>
<head>
	<title>TheBomber 2D</title>
	<!-- Bootstrap 4.5.0 -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
	<!-- jQuery  3.5.1 -->
	<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
	<!-- jQuery UI 1.12.1 -->
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>
	<!-- Bootstrap JavaScript -->
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	<!-- JavaScript Bundle -->
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" integrity="sha384-1CmrxMRARb6aLqgBO7yyAxTOQE2AKb9GfXnEo760AUcUmFx3ibVJJAzGytlQcNXd" crossorigin="anonymous"></script>
	<!-- Font Awesome 5 -->
	<script src="https://kit.fontawesome.com/a076d05399.js"></script>
	<!-- My JavaScript code -->
	<script src="../js/js.js"></script>
	<!-- My CSS code -->
	<link rel="stylesheet" type="text/css" href="../css/style.css">
</head>
<body>
	<header>TheBomber2D</header>
	<nav class="navbar navbar-expand-lg navbar-light bg-light"> 
    	<a class="navbar-brand" href="../index.html"><i class="fas fa-home"></i></a> 
    	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    	        <span class="navbar-toggler-icon"></span>
    	</button>
    	<div class="collapse navbar-collapse" id="navbarNav">
    	    <ul class="navbar-nav"> 
    	        <li class="nav-item"> <a class="nav-link" href="game.html">Play game</a></li>
            </ul>
        </div>
    </nav>
	<section>
		<p>How do you want to play:</p>
		<div class="row">
			<div class="col-4 offset-2">
				<label for="selection">By selecting</label>
				<input type="radio" name="inputing" id="selection" value="selection" checked>
			</div>
			<div class="col-4 offset-2">
				<label for="typing">By direct input:</label>
				<input type="radio" name="inputing" id="typing" value="typing">
			</div>	
		</div>
		<div id="selectionDiv">
			<button class="btn btn-outline-secondary" id="newRow">Add row</button>
			<button class="btn btn-outline-dark" id="newField">Add field</button>
			<button class="btn btn-outline-danger" id="deleteRow">Delete row</button>
			<button class="btn btn-outline-danger" id="deleteField">Delete field</button>
			<div id="selectionContainer" class="container">
				<p id="inputStart">[</p>

				<p id="inputEnd">]</p>
			</div>
			<button class="btn btn-outline-info" id="submitSelecting">Play</button>
		</div>
		<div id="typingDiv">
			<textarea id="inputData" name="inputData" rows="20" cols="80"></textarea>
			<button class="btn btn-outline-info" id="submitTyping">Play</button>
		</div>
	</section>
	<script type="text/javascript">
		$("#typingDiv").hide();
		let inputTypes = $("input[name=inputing]");
		$(inputTypes).each(function(ind, el){
			$(this).on('change', function(e) {
				let divToShow = $(this).val()+"Div";
				$("#selectionDiv").hide();
				$("#typingDiv").hide();
				$("#"+divToShow).show();
			});
		});

		// For inputing using selects
		let newRow = $("#newRow"), row = 0, col = 1;
		$(newRow).on("click", addRow);
		// Add new col html code
		function newColHtmlCode(col){
			let htmlToAdd = "";
			htmlToAdd = "<div class='inputCol col"+col+"'>"
			htmlToAdd += "<span>[</span>";
			htmlToAdd += "<select name='col"+col+"'>";
			htmlToAdd += "<option value='E'>E</option>";
			htmlToAdd += "<option value='0'>0</option>";
			htmlToAdd += "<option value='W'>W</option>";
			htmlToAdd += "</select>";
			htmlToAdd += "<span>] ,</span>";
			htmlToAdd += "</div>";

			return htmlToAdd;
		}
		// Add a row
		function addRow(){
			row++;
			let htmlToAdd = "<div class='inputRow' id='row"+row+"'>";
			for (let i = 1; i <= col; i++) {
				htmlToAdd += newColHtmlCode(i);
			}
			htmlToAdd += "</div><p class='rowP"+row+"'></p>";
			$("#inputEnd").before(htmlToAdd);
		}

		let addCol = $("#newField");
		// Add a col
		$(addCol).on("click", function(){
			// Check if there are no rows
			if ($("#selectionContainer").children("div").length <= 0) {
				addRow();
			}else{
				let inputRow = $(".inputRow");
				// If in the code have some rows add to all of them 1 more column
				$(inputRow).each(function(ind) {
					let htmlToAdd = newColHtmlCode(col+1);
					$(this).append(htmlToAdd);
				});
				col++;
			}
		});
		// Delete a row
		let deleteRow = $("#deleteRow");
		$(deleteRow).on('click', function() {
			// Select all rows
			if (row > 0) {
				let id = "#row"+row, classRowP = ".rowP"+row;
				$(id).remove();
				$(classRowP).remove();
				row--;
			}else{
				alert("There are no rows to be deleted!");
			}
		});
		// Delete a col
		let deleteCol = $("#deleteField");
		$(deleteCol).on("click", function () {
			if (col > 1) {
				let classCol = ".col"+col;

				$("#selectionContainer").find(classCol).remove();			
				col--;
			}else if(col === 1){
				$(".inputRow").each(function(ind) {
					$(this).remove();
					let classRowP = ".rowP"+(ind+1);
					$(classRowP).remove();
					row--;
				});
				col--;
			}else{
				alert("There are no cols to be deleted!");
			}
			
		})
		// Submit the selecting form
		let btnSubmit = $("#submitSelecting");
		$(btnSubmit).on("click", function(){
			let num = 0, inputData = [];
			inputData[0] = [];
			$("select").each(function(ind, el){
				if ((ind)%col == 0 && ind !=0) {
					// New line
					num++;
					inputData[num] = [];
					let str = $(this).val();
					inputData[num].push(str);
				}else{
					let str = $(this).val();
					inputData[num].push(str);
				}

			});
			checkInputForErrors(inputData);
		});
		// Check the input for errors
		function checkInputForErrors(inputData){
			if (checkIfInputSubArrLengthIsNotEqual(inputData)) {
				if (checkIfTheInputIsCorrect(inputData)) {
					// Save the data in localStorage
					localStorage.setItem("inputData", JSON.stringify(inputData));
					setTimeout(function () {
						window.location.href = "game_result.html";
					}, 100 );
					
				}else{
					// If there are previous errors remove them	
					if ($(".alert-danger").length != 0) {
						$(".alert-danger").remove();
					}
					// Add error message
					let error = "<p class='alert-danger'>Input includes characters different the the allowed!!!</p>";
					$("#selectionDiv").before(error);
				}
			}else{
				// If there are previous errors remove them
				if ($(".alert-danger").length != 0) {
						$(".alert-danger").remove();
					}
				// Add error message
				let error = "<p class='alert-danger'>The number of columns in each rows is different!!!</p>";
				$("#selectionDiv").before(error);
			}
		}
		// Direct typing array option
		let btnSubmitTyping = $("#submitTyping");
		$(btnSubmitTyping).on("click", function(){
			let  inputData = $("#inputData").val(), finalData = [];
			finalData = JSON.parse(inputData);

			checkInputForErrors(finalData);
		});
	</script>
</body>
</html>