<!DOCTYPE html>
<html>
<head>
	<title>TheBomber 2D</title>
	<!-- Bootstrap 4.5.0 -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
	<!-- jQuery  3.5.1 -->
	<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
	<!-- jQuery UI 1.12.1 -->
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>
	<!-- Bootstrap JavaScript -->
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	<!-- JavaScript Bundle -->
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" integrity="sha384-1CmrxMRARb6aLqgBO7yyAxTOQE2AKb9GfXnEo760AUcUmFx3ibVJJAzGytlQcNXd" crossorigin="anonymous"></script>
	<!-- Font Awesome 5 -->
	<script src="https://kit.fontawesome.com/a076d05399.js"></script>
	<!-- My JavaScript code -->
	<script src="../js/js.js"></script>
	<!-- My CSS code -->
	<link rel="stylesheet" type="text/css" href="../css/style.css">
</head>
<body>
	<header><h1 class="text-center">TheBomber2D</h1></header>
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
	    <a class="navbar-brand" href="../index.html"><i class="fas fa-home"></i></a>
	    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
	        <span class="navbar-toggler-icon"></span>
	    </button>
	    <div class="collapse navbar-collapse" id="navbarNav">
	        <ul class="navbar-nav">
	            <li class="nav-item"> <a class="nav-link" href="game.html">Play game</a></li>
	        </ul>
	    </div>
	</nav>
	<section>
		<h2>Result:</h2>
		<p>Maximum number of enemies you can destroy using one bomb: <span class="green"></span></p>
		<p>You have <span id="ways"></span> ways to throw the bomb and hit max enemies.</p>
	</section>
	<script type="text/javascript">
		if (localStorage.getItem("inputData") == null) {
			window.location.href = "game.html";
		}
		let inputData = localStorage.getItem("inputData");
		if (inputData.length > 0) {
			localStorage.removeItem("inputData");
			inputData = JSON.parse(inputData);
		}
		
		function whereToColor(inputData, x, y, targets, loopEnd, ifArg1, ifArg2, varToChange){
			let rowNum = x,
				colNum = y, ifArg1New;

			for (let k = 0; k < loopEnd; k++) {
				if (ifArg1 == "x") {
					ifArg1New = rowNum;
				}else if (ifArg1 == "y"){
					ifArg1New == colNum;
				} 
				if ((+ifArg1New) == (+ifArg2)) {
					break;
				}
				if (inputData[rowNum][colNum] == "W") {
					break;
				} else {
					targets.row.push(rowNum);
					targets.col.push(colNum);
				}
				switch(varToChange) {
					case 0:
		                colNum++;
		                break;
		            case 1:
		                rowNum++;
		                break;
		            case 2:
		                colNum--;
		                break;
		            case 3:
		                rowNum--;
		                break;
				}
			}
			return targets;
		}
		function playGame(inputData){
			if (checkIfInputArrIsEmpty(inputData)) {
				if (checkIfInputSubArrIsEmpty(inputData)) {
					if (checkIfInputDoesNotContain0(inputData)) {
						if (checkIfInputDoesNotContainEnemies(inputData)) {
							return game(inputData);
						}else{
							return 0;
						}
					}else{
						return 0;
					}
				}else{
					return 0;
				}
			}else{
				return 0;
			}
		}
		let result = playGame(inputData), strToAppend = "";
		if (result) {
			$(".green").text(result[0].value);
			$("#ways").text(result.length);
			for (let ind in result) {
				strToAppend = "";
				strToAppend += "<hr><div class='way"+(+ind+1)+"'>";
				strToAppend += "<p>You will hit " +result[0].value+ " enemies </p>";
				strToAppend += "<p>You may drop the bomb on the <span style='color:#00f'>blue</span> and will hit the enemies in <span style='color:#f00'>red</span></p>";
				strToAppend += "<table class='table table-striped' border='1'>";
				let targets = {};
				targets.row = [];
				targets.col = [];

				// Search for rnrmy in a row (form let to rigth) => x is not changing
				whereToColor(inputData, result[ind].rowToDrop, result[ind].colToDrop, targets, inputData[0].length, "y", inputData[0].length, 0);

				// Searching for enemy in a cols (form top to down) => y is not changing
				whereToColor(inputData, result[ind].rowToDrop, result[ind].colToDrop, targets, inputData.length, "x", inputData.length, 1);

				// Search for rnrmy in a row (form rigth to left) => x is not changing
				whereToColor(inputData, result[ind].rowToDrop, result[ind].colToDrop, targets, inputData[0].length, "y", -1, 2);
				
				// Searching for enemy in a cols (form down to top) => y is not changing
				whereToColor(inputData, result[ind].rowToDrop, result[ind].colToDrop, targets, inputData.length, "x", -1, 3);

				for (let i = 0; i < inputData.length; i++) {
					strToAppend += "<tr>";
					for (let j = 0; j < inputData[i].length; j++) {
						strToAppend += "<td>" + inputData[i][j] + "</td>";
					}
					strToAppend += "</tr>";
				}
				strToAppend += "</table>";
				strToAppend += "</div>";
				$("section").append(strToAppend);
				for (let index in targets.row) {
					let tr = ".way"+(+ind+1)+" table tr:nth-of-type("+(+targets.row[index]+1)+")", td = "td:nth-of-type("+(+targets.col[index]+1)+")";
					if (result[ind].rowToDrop == targets.row[index] && result[ind].colToDrop == targets.col[index]) {
						$(tr).children(td).attr("class", "blueTd");
					}else{
						$(tr).children(td).attr("class", "redTd");
					}
				}
			}
		}else{
			// If result is equal to 0 display it
			$(".green").text(result);
			$("p:last").remove();
			let divContent = "";
			divContent = "<div class='result'>";
			divContent += "<table class='table table-striped' border='1'>";
			for (let i = 0; i < inputData.length; i++) {
				divContent += "<tr>";
				for (let j = 0; j < inputData[i].length; j++) {
					divContent += "<td>" + inputData[i][j] + "</td>";
				}
				divContent += "</tr>";
			}
			divContent += "</table>";
			divContent += "</div>";
			$("p:last").after(divContent);
		}
	</script>
</body>
</html>